function Z(){import("data:text/javascript,")}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const T=["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"];function p(){return l(Date.now())}function l(s){const t=new Date(s),e=t.getTimezoneOffset()+8*60;return t.setMinutes(t.getMinutes()+e+2),t}function g(s){const t=y(s)?"\u6D3B\u52A8\u65E5":"\u661F\u671F"+T[s.getDay()];return s.getMonth()+1+"\u6708"+s.getDate()+"\u65E5 "+t}function u(s){return m(s.getHours())+":"+m(s.getMinutes())}function m(s){return s<10?"0"+s:s.toString()}function y(s){return(new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime()-new Date(2022,9,26).getTime())/24/60/60/1e3%14===0}const w="_container_1rxv1_1",x="_date_1rxv1_6",N="_time_1rxv1_13",h={container:w,date:x,time:N};class C{constructor(){this.container=document.createElement("div"),this._dateText="",this._timeText="",this._dateElement=document.createElement("div"),this._timeElement=document.createElement("div"),this.container.className=h.container,this._dateElement.className=h.date,this.container.appendChild(this._dateElement),this._timeElement.className=h.time,this.container.appendChild(this._timeElement)}update(){const t=p(),e=g(t),n=u(t);e!==this._dateText&&(this._dateText=e,this._dateElement.innerText=this._dateText),n!==this._timeText&&(this._timeText=n,this._timeElement.innerText=this._timeText)}}const D="_container_19ne4_1",j="_body_19ne4_8",H="_hourRow_19ne4_11",L="_hourLabel_19ne4_15",$="_cursor_19ne4_22",A="_event_19ne4_40",R="_content_19ne4_52",F="_subject_19ne4_58",M="_time_19ne4_61",O="_smaller_19ne4_75",S="_smallest_19ne4_76",c={container:D,body:j,hourRow:H,hourLabel:L,cursor:$,event:A,content:R,subject:F,time:M,smaller:O,smallest:S},_=70,k=12;class B{constructor(){this.container=document.createElement("div"),this._body=document.createElement("div"),this._cursor=document.createElement("div"),this._eventElements=[],this._events=[],this.container.className=c.container,this._body.className=c.body,this.container.appendChild(this._body),this._cursor.className=c.cursor,this._cursor.innerHTML="<span>",this.container.appendChild(this._cursor),this._initTable()}getEvents(){return this._events}setEvents(t){this._events=t,this._updateEvents()}update(){const t=p(),e=t.getHours();this._cursor.style.top=this._calculateY(e,t.getMinutes())+"px";const n=this._calculateY(e<=14?e:14)-12;n!=this.container.scrollTop&&(this.container.scrollTop=n)}_initTable(){for(let t=0;t<=24;t++){const e=document.createElement("div");e.className=c.hourRow,e.style.height=`${_}px`;const n=document.createElement("span");n.className=c.hourLabel,n.innerText=`${m(t)}:00`,e.appendChild(n),this._body.appendChild(e)}}_updateEvents(){var e;const t=this._events;for(;this._eventElements.length>t.length;){const n=this._eventElements.pop();(e=n==null?void 0:n.parentNode)==null||e.removeChild(n)}for(;this._eventElements.length<t.length;){const n=this._appendEventElement();this._eventElements.push(n)}t.forEach((n,i)=>{const o=this._eventElements[i];this._updateEvent(n,o)})}_appendEventElement(){const t=document.createElement("div");t.className=c.event;const e=document.createElement("div");e.className=c.content,t.appendChild(e);const n=document.createElement("h3");n.className=c.subject,e.appendChild(n);const i=document.createElement("div");return i.className=c.time,e.appendChild(i),this.container.appendChild(t),t}_updateEvent(t,e){const n=e.children[0],i=n.children[0],o=n.children[1],a=l(t.startTime),E=l(t.endTime),b=E.getTime()-a.getTime();e.id=t.id,i.innerText=t.subject,o.innerText=`${u(a)} - ${u(E)}${t.location?",  "+t.location:""}`;const d=b/60/60/1e3*_;e.style.height=`${d}px`,e.style.top=`${this._calculateY(a.getHours(),a.getMinutes())}px`,d<40?(e.classList.add(c.smallest),e.classList.remove(c.smaller)):d<60?(e.classList.add(c.smaller),e.classList.remove(c.smallest)):(e.classList.remove(c.smaller),e.classList.remove(c.smallest))}_calculateY(t,e=0){return k+(t+e/60)*_}}const I="_container_17fp0_1",Y="_content_17fp0_11",q="_subject_17fp0_23",P="_time_17fp0_27",K="_location_17fp0_28",G="_buttonRow_17fp0_31",z="_button_17fp0_31",r={container:I,content:Y,subject:q,time:P,location:K,buttonRow:G,button:z};class U{constructor(){this.container=document.createElement("div"),this._content=document.createElement("div"),this._subject=document.createElement("h2"),this._time=document.createElement("div"),this._location=document.createElement("div"),this._buttonRow=document.createElement("div"),this._button=document.createElement("button"),this._autoHideTimer=0,this._handleOK=()=>{this.hide()},this.container.className=r.container,this._content.className=r.content,this.container.appendChild(this._content),this._subject.className=r.subject,this._content.appendChild(this._subject),this._time.className=r.time,this._content.appendChild(this._time),this._location.className=r.location,this._content.appendChild(this._location),this._button.className=r.button,this._button.innerText="\u597D\u7684\uFF0C\u77E5\u9053\u4E86",this._buttonRow.className=r.buttonRow,this._buttonRow.appendChild(this._button),this._button.addEventListener("click",this._handleOK,!0),this._content.appendChild(this._buttonRow)}showEventAlert(t){this._clearAutoHideTimer(),this._subject.innerText=t.subject,this._time.innerText="\u65F6\u95F4\uFF1A"+u(l(t.startTime))+" - "+u(l(t.endTime)),t.location&&(this._location.innerText="\u4F1A\u8BAE\u5BA4\uFF1A"+t.location),this._location.style.display=t.location?"block":"none",this._autoHide()}hide(){var t;this._clearAutoHideTimer(),(t=this.container.parentNode)==null||t.removeChild(this.container)}_autoHide(){this._autoHideTimer=window.setTimeout(()=>{this.hide()},4*60*1e3)}_clearAutoHideTimer(){this._autoHideTimer&&(window.clearTimeout(this._autoHideTimer),this._autoHideTimer=0)}}const v=new U;function W(s){document.body.appendChild(v.container),v.showEventAlert(s)}const J="_header_14g9m_1",V="_content_14g9m_7",f={header:J,content:V};class X{constructor(t){this.container=t,this._updateEvents=async()=>{const i=await this._request("data/events.json");this._eventTable.setEvents(i)},window.location.port==="5173"&&(document.title="DEV - Kindle Moment");const e=document.createElement("div");e.className=f.header,this.container.appendChild(e);const n=document.createElement("div");n.className=f.content,this.container.appendChild(n),this._clock=new C,e.appendChild(this._clock.container),this._eventTable=new B,this._eventTable.container.style.height="728px",n.appendChild(this._eventTable.container)}update(){console.info("Update"),this._clock.update(),this._eventTable.update();const t=this._eventTable.getEvents();for(const e of t){const n=Date.now()-e.startTime;if(n>=-3*60*1e3&&n<=-2*60*1e3){W(e);break}}}async start(){await this._updateEvents(),this.update(),setInterval(this._updateEvents,3*60*1e3);{const t=p();console.info(`Will update in ${61-t.getSeconds()} seconds.`),setTimeout(()=>{this.update(),setInterval(()=>{this.update()},60*1e3)},(61-t.getSeconds())*1e3)}}_request(t){return new Promise(e=>{const n=new XMLHttpRequest;n.onreadystatechange=()=>{if(n.readyState===4&&(n.onreadystatechange=null,n.status===200)){const i=n.responseText,o=JSON.parse(i);e(o)}},n.open("GET",t+"?t="+Date.now()),n.send()})}}function Q(){const s=document.getElementById("root");s&&new X(s).start()}Q();export{Z as __vite_legacy_guard};
